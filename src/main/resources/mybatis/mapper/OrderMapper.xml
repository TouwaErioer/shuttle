<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.hope.model.mapper.OrderMapper">

    <resultMap id="result" type="com.example.hope.model.vo.OrdersVO">
        <result column="clientName" property="client.name"/>
        <result column="clientPhone" property="client.phone"/>
        <result column="clientAddress" property="client.address"/>
        <result column="serviceName" property="service.name"/>
        <result column="servicePhone" property="service.phone"/>
        <result column="productId" property="product.id"/>
        <result column="productName" property="product.name"/>
        <result column="productImage" property="product.image"/>
        <result column="productPrice" property="product.price"/>
        <result column="productRate" property="product.rate"/>
        <result column="productSales" property="product.sales"/>
    </resultMap>

    <sql id="select">
        SELECT
        orders.*,
        client.NAME AS clientName,
        client.phone AS clientPhone,
        client.address AS ClientAddress,
        service.NAME AS serviceName,
        service.phone AS servicePhone,
        product.NAME AS productName,
        product.image AS productImage,
        product.price AS productPrice,
        round( product.rate, 1 ) AS productRate,
        product.sales AS productSales,
        store.NAME AS storeName,
        store.business_id AS businessId,
        store.id AS storeId
        FROM
            orders,
            USER AS client,
            USER AS service,
            product
            LEFT JOIN store ON product.store_id = store.id
        WHERE
            orders.cid = client.id
            AND orders.sid = service.id
            AND orders.pid = product.id
    </sql>

    <select id="selectByPage" resultMap="result">
        <include refid="select"/>
        #{ew.customSqlSegment}
    </select>

    <select id="selectByList" resultMap="result">
        <include refid="select"/>
        #{ew.customSqlSegment}
    </select>

    <select id="detail" resultMap="result" parameterType="long">
        <include refid="select"/>
        AND orders.id = #{id}
    </select>
</mapper>
